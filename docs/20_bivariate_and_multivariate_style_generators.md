# Chapter 20: Bivariate and Multivariate Style Generators

Welcome to Chapter 20! ğŸ‰

In the last few chapters, you learned how Disaster Ninja represents complex data layers and manages how they show up on the map. But hereâ€™s a key question:

> "How does the app decide what colors to use on the map based on different data points?"

This is where the concept of bivariate and multivariate styles comes in â€” and theyâ€™re generated by something called the...

ğŸ¨**Bivariate and Multivariate Style Generators**

In this chapter, weâ€™ll unpack this design system and learn how it brings data to life through map visuals.

---

## ğŸ¯ Why Bivariate and Multivariate Styles?

Imagine you want to visualize two important factors on a map:
- Population density
- Flood risk levels

You could color areas red if flood risk is high, or blue if density is high. But what if both are high? What color shows that?

Bivariate styles let us:
âœ… Combine multiple data points  
âœ… Represent them with grid colors  
âœ… Help users interpret complex layered information visually

And **Multivariate** styles do the same across 3 or more factors!

---

## ğŸ§  What Are Style Generators?

Think of style generators as smart artists. ğŸ¨

> They take multiple layers of data, and choose the perfect color for every area on the map â€” based on well-defined rules or color schemas.

Theyâ€™re not drawing lines manually. They follow formulas which map data combinations to visual values â€” like a style blueprint.

---

## ğŸ§° Key Concepts â€” Simplified

| Term | Meaning | Analogy |
|------|---------|---------|
| Bivariate | Visualizing two data dimensions (e.g. flood risk + density) | A 2-axis graph ğŸ“Š |
| Multivariate | 3 or more data dimensions | A radar chart ğŸ•¸ï¸ |
| Style Generator | A function that creates a color map or style config | A rulebook for shading a map ğŸ¨ |
| Matrix | A grid showing all value combinations | A style palette for data combinations ğŸ§® |

Letâ€™s bring these ideas to life!

---

## ğŸ§ª Real-World Use Case: Visualizing Risk on the Map

Letâ€™s say your dataset contains:

- Axis X: "Number of elderly residents" (Low â†’ High)  
- Axis Y: "Distance from nearest hospital" (Far â†’ Close)

You want to shade each region with a color that reflects this combo.

Your **bivariate style generator** does exactly that:
- Looks at where a region falls on both axes
- Matches it to a color
- Generates a map style so the UI can color that region

Result: with just a glance, users can spot high-risk areas where elderly populations are far from hospitals. ğŸ§“ğŸ¥

---

## ğŸ¨ How Styles Are Generated

Hereâ€™s a simplified flow of how a bivariate style generator works:

```mermaid
flowchart TD
  A[Input: X + Y values for every feature]
  B[Split values into low/medium/high]
  C[Cross X and Y to determine which matrix cell applies]
  D[Return the matching color]
  E[Apply color to feature in the style]

  A --> B --> C --> D --> E
```

ğŸ§  For tool developers, itâ€™s like color-by-numbers â€” but the numbers come from your data!

---

## ğŸ”¨ How the Style Generator Works (Code Overview)

Let's look at a simplified version of a Bivariate Style Generator:

ğŸ“„ `/src/map/styleGenerators/bivariate.ts`

```ts
export function generateBivariateStyle(xGroups, yGroups, colorMatrix) {
  return (feature) => {
    const xValue = getFeatureValue(feature, 'xAxis');
    const yValue = getFeatureValue(feature, 'yAxis');

    const xGroup = findGroup(xGroups, xValue);
    const yGroup = findGroup(yGroups, yValue);

    const color = colorMatrix[xGroup][yGroup];
    return {
      color,
      opacity: 1,
    };
  };
}
```

âœï¸ Each feature:
- Reads its X and Y axis values
- Looks up where it falls in both groups
- Picks a color from the matrix
- Returns a visual style

This style is passed to the map layer renderer.

---

## ğŸŒ Where Are These Used?

Bivariate and multivariate styles are foundational to showing:

- Vulnerability maps  
- MCDA (Multi-Criteria Decision Analysis) outputs  
- Impact assessment visualizations  
- Geography-based scoring systems

When you see a colorful grid-style map in Disaster Ninja â€” chances are, it comes from a style generator. ğŸ“ŠğŸ¨

---

## ğŸ“Š What Is a Style Matrix?

The color matrix is a 2D grid like this:

|        | Low Y | Medium Y | High Y |
|--------|--------|----------|--------|
| Low X  | ğŸŸ¦     | ğŸŸª       | ğŸŸ¥     |
| Medium X | ğŸŸ¨     | ğŸŸ©       | ğŸŸ§     |
| High X | â¬œ     | ğŸŸ«       | â¬›     |

The generator chooses the cell that matches the feature's X and Y category (group), and applies the matching color.

This helps users instantly understand categories like:
- "High risk, low readiness"
- "Moderate risk, high capacity"

â€”

## ğŸ§© And What About Multivariate?

Itâ€™s similar, but with a few more dimensions!

Instead of choosing from a 2D grid, a multivariate generator might:
- Combine 3 or more axes
- Create a unique color based on multiple values (via a color function)
- Group dimensions into scores or indices

For example:

```ts
const color = computeColor({
  elderly: 0.7,
  hospitalAccess: 0.4,
  incomeLevel: 0.8,
});
```

Itâ€™s more complex â€” but powerful. Thatâ€™s how MCDA visualizations work.

---

## ğŸ–¼ï¸ Visualization of the Generatorâ€™s Role

Letâ€™s visualize the data filtering process:

```mermaid
sequenceDiagram
  participant Feature
  participant Generator as Style Generator
  participant Matrix
  participant Renderer

  Feature-->>Generator: Provide X and Y values
  Generator-->>Matrix: Look up color
  Matrix-->>Generator: Return color
  Generator-->>Renderer: Send style
  Renderer-->>Map: Apply color to feature
```

Everything happens automatically under the hood â€” users just see a styled map!

---

## ğŸ§  Where to Find This in the Project

In Disaster Ninja, style generators can be found in:

ğŸ“ `/src/map/styleGenerators/`

- `bivariate.ts`
- `multivariate.ts`
- `mcdaStyle.ts`

Theyâ€™re used alongside:
- MCDA logic (Chapter 18â€“19)
- Color managers (like [Chapter 21: Bivariate Color Manager](21_bivariate_color_manager.md))
- Rendering tools ([Chapter 187: Bivariate Renderer](187_bivariate_renderer.md), [Chapter 178: Multivariate Renderer](178_multivariaterenderer.md))

---

## ğŸ’¡ TL;DR Summary

âœ“ Bivariate Style Generators match TWO data axes to a color  
âœ“ Multivariate Style Generators handle 3+ dimensions  
âœ“ They produce **color styles** to paint the map dynamically  
âœ“ A grid-style **color matrix** helps visually encode data  
âœ“ The system handles mappings automatically for every feature

Thanks to this, users can easily see...
- Where help is needed most  
- Where risks intersect  
- Where to focus first in a disaster ğŸ¯

---

Next up: Want to learn how these generators get their color palettes and manage visual rules?

â¡ï¸ Head to [Chapter 21: Bivariate Color Manager](21_bivariate_color_manager.md)

More color, more clarity, more insight â€” keep exploring, style wizard! ğŸ§™ğŸ¨ğŸ—ºï¸

# Chapter 20: Bivariate and Multivariate Style Generators

Welcome back, wizard of weighted scores! ğŸ§™â€â™€ï¸ğŸ“Š

In [Chapter 19: MCDA Scoring Engine](19_mcda_scoring_engine.md), we saw how Disaster Ninja calculates one final score for each zone â€” based on your selected map criteria and priorities.

But now that we have numbers (MCDA scores), hereâ€™s the next big question:

> â€œHow do we actually show these results to users on the map in a way thatâ€™s easy to understand?â€

ğŸ”¥ Thatâ€™s what this chapter is about: **Styling the map with colors that reflect multi-dimensional results** â€” so people can instantly â€œseeâ€ which areas matter.

---

## ğŸ¯ Central Use Case: Show Two (or More) Criteria At Once

Imagine this:

> â€œI want to see which areas have high flood risk AND high population density.â€

Or maybe...

> â€œWhere is there poor hospital access, but still lots of vulnerable people?â€

In single-criterion maps, youâ€™d just use one color scale (e.g., blue = low to red = high flood risk). But what about two? Or three?

âš™ï¸ Thatâ€™s where we use:

- â†’ **Bivariate styling** (2 dimensions)
- â†’ **Multivariate styling** (3+ dimensions)

Letâ€™s make sense of it, step by step.

---

## ğŸ§± Key Concepts â€” Style Basics for Beginners

Letâ€™s unpack what we mean by these fancy style words ğŸ‘‡

### 1. ğŸ¨ Style Generator
This is a function that builds map styling rules from MCDA or other data output.

It decides:
- What color to use for each zone
- Which borders, icons, fills to apply

Example:
```ts
{ fillColor: "#FF0000", strokeColor: "#FFFFFF" }
```

These styles drive what you see on the map!

### 2. ğŸŸ¦ğŸŸ¥ Bivariate Style
This shows **two criteria at once**, using a color grid.

Imagine:
- X-axis = Flood Risk (low â†’ high)
- Y-axis = Population Density (low â†’ high)

We create a color matrix like this:

|         | Low Pop | Mid Pop | High Pop |
|---------|---------|---------|----------|
| Low Flood | ğŸŸ©       | ğŸŸ¨       | ğŸŸ¥        |
| High Flood| ğŸŸ¦       | ğŸŸ¦ğŸŸ¥      | ğŸŸ¥â¬›       |

Each zoneâ€™s color reflects **both values** together!

### 3. ğŸŒ Multivariate Style
This extends to **3+ indicators**, and uses advanced rules:
- Blended colors
- Symbols or icons
- Layer overlays

More flexible â€” but also more abstract.

---

## ğŸ§ª Use Case: Color Zones by Flood Risk + Population

Letâ€™s walk through a very simple example.

We want to merge:
- Flood risk: `0.0 â†’ 1.0`
- Population: `0.0 â†’ 1.0`

We break each into â€œLowâ€, â€œMediumâ€, â€œHighâ€ ranges.

```ts
function classifyZone(zone) {
  const floodBucket = zone.flood > 0.66 ? "high"
                   : zone.flood > 0.33 ? "medium" : "low";

  const popBucket = zone.population > 0.66 ? "high"
                  : zone.population > 0.33 ? "medium" : "low";

  return `${floodBucket}-${popBucket}`; // e.g., "high-low"
}
```

ğŸ§  This gives us a label that maps to a color.

Now style it:

```ts
const colorMap = {
  "low-low": "#D4EEFF",
  "low-medium": "#A2D9FF",
  "low-high": "#69B3FF",
  "medium-low": "#FFDEB1",
  "medium-medium": "#FFA763",
  "medium-high": "#FF7A00",
  "high-low": "#FFCCCC",
  "high-medium": "#FF6666",
  "high-high": "#CC0000",
};
```

Put it together:

```ts
function getStyle(zone) {
  const key = classifyZone(zone);
  return {
    fillColor: colorMap[key] || "#CCCCCC", // fallback color
    fillOpacity: 0.8,
    strokeColor: "#333333",
  };
}
```

ğŸ‰ You now have bivariate coloring â€” with clear visuals!

---

## âš™ï¸ Whatâ€™s Happening Behind the Scenes

Letâ€™s visualize the inner flow when map styling is generated:

```mermaid
sequenceDiagram
  participant UI as User Interface
  participant StyleGen as Style Generator
  participant MCDA as Scored Data
  participant Map as Map Renderer

  UI->>StyleGen: Request style based on flood + pop
  StyleGen->>MCDA: Fetch zone flood + pop values
  StyleGen->>Map: Return { fillColor } per zone
  Map->>UI: Render map with colored results
```

â˜‘ï¸ Each zone is styled dynamically based on its data values.

---

## ğŸ’¡ Internally: Where Disaster Ninja Styles Zones

When generating styles, Disaster Ninja uses:
- A reusable `generateBivariateStyle()` function
- Color templates and grids
- Normalized input values (0.0â€“1.0)

ğŸ“ `lib/styles/bivariateStyleGenerator.ts`

```ts
export function generateZoneStyle(zone, xAccessor, yAccessor, colorGrid) {
  const x = xAccessor(zone); // e.g., zone.flood
  const y = yAccessor(zone); // e.g., zone.pop

  const xBin = Math.floor(x * 3); // 0â€“2
  const yBin = Math.floor(y * 3); // 0â€“2

  const color = colorGrid[yBin][xBin];
  return {
    fillColor: color,
    fillOpacity: 0.7,
  };
}
```

ğŸ§  This styles each zone by:
- Getting its input values
- Converting to 3x3 grid bins
- Looking up the color and returning a style

---

## ğŸ§° Tip: Try It in the App

Under â€œMCDA configurationâ€:
1. Set two criteria as most important (e.g., flood + pop)
2. Choose â€œBivariate Color Styleâ€
3. Map updates with dual-dimension colors instantly!
4. Hover to see which values place each zone where

ğŸ“Š Itâ€™s like seeing your decision model... turned into a heatmap!

---

## âœ… Summary

Youâ€™ve learned:

âœ” What bivariate and multivariate styles are  
âœ” How Disaster Ninja shows 2+ indicators together  
âœ” How zones are color-coded based on combinations of values  
âœ” Simple ways to classify and assign colors  
âœ” How the internal generator matches colors using data bins  

Bivariate styles take decision-making from numbers â†’ to something even your grandma can read at a glance! ğŸ‘µğŸ—ºï¸

---

ğŸ¯ Next up: Ever want to â€œlock inâ€ those results or layer them against other scenarios?

â¡ï¸ Keep going to [Chapter 21: Result Layer Configuration](21_result_layer_configuration.md)  
Itâ€™s time to turn styles into shareable insights! ğŸ’¾ğŸ”¥ğŸ“